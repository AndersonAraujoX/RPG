<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arquivos de Kuar-Tor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            background-color: #000;
            color: #00ff41; /* Cor do texto do terminal */
            text-shadow: 0 0 5px #00ff41, 0 0 10px #00ff41;
            image-rendering: pixelated;
            overflow: hidden;
        }

        .vhs-wrapper {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        .vhs-wrapper::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.4) 0px, rgba(0,0,0,0.4) 1px, transparent 1px, transparent 2px);
            animation: vhs-scanlines 2s steps(4) infinite;
            pointer-events: none;
            z-index: 2;
        }
        
        .vhs-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a2e;
            opacity: 0.1;
            z-index: -1;
            animation: vhs-flicker 0.15s infinite;
        }

        @keyframes vhs-scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(8px); }
        }
        
        @keyframes vhs-flicker {
            0%, 100% { opacity: 0.1; }
            50% { opacity: 0.2; }
        }

        .content-glitch {
             animation: vhs-glitch 2.5s linear infinite alternate-reverse;
        }

        @keyframes vhs-glitch {
          2%,64% { transform: translate(1px,-1px) skew(0deg); }
          4%,60% { transform: translate(-1px,1px) skew(0deg); }
          62% { transform: translate(0,0) skew(2deg); }
        }
        
        .terminal {
            width: 100%;
            height: 100vh;
            padding: 2rem;
            overflow-y: auto;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none;  /* Internet Explorer 10+ */
        }
        .terminal::-webkit-scrollbar { 
            display: none;  /* Safari and Chrome */
        }
        
        #terminal-output p, #terminal-output div {
            white-space: pre-wrap;
            word-break: break-all;
        }

        .prompt-input {
            background: transparent;
            border: none;
            outline: none;
            color: #00ff41;
            text-shadow: 0 0 5px #00ff41, 0 0 10px #00ff41;
            width: 100%;
        }

        .cursor {
            display: inline-block;
            width: 10px;
            height: 1.2em;
            background-color: #00ff41;
            animation: blink 1s step-end infinite;
            box-shadow: 0 0 5px #00ff41, 0 0 10px #00ff41;
        }

        @keyframes blink {
            from, to { background-color: transparent; }
            50% { background-color: #00ff41; }
        }
    </style>
</head>
<body>

    <div class="vhs-wrapper">
        <div id="terminal" class="terminal content-glitch" onclick="initiateConnection()">
            <div id="terminal-output" class="text-sm md:text-base"></div>
            <div id="input-line" class="flex" style="display: none;">
                <span id="prompt-symbol" class="text-green-400">></span>
                <input type="text" id="password-input" class="prompt-input flex-1 ml-2">
                <span class="cursor"></span>
            </div>
        </div>
    </div>

    <script>
        const terminalOutput = document.getElementById('terminal-output');
        const inputField = document.getElementById('password-input');
        const inputLine = document.getElementById('input-line');
        const promptSymbol = document.getElementById('prompt-symbol');
        let isAudioStarted = false;
        let typeSound;
        let currentRiddle = null;

        const riddles = {
            "ajuda": {
                riddle: "Exibindo lista de chaves de sincronização conhecidas...",
                answer: "Chaves disponíveis: Ezuadir, Necropolis, Laplace, Vento Ardente, Vento Glacial. Digite 'limpar' para limpar o terminal."
            },
            "ezuadir": {
                riddle: "Eu unifiquei um império com uma lâmina que corta a realidade. Quem sou eu?",
                answer: "Uma lenda forjada em fogo e ambição. Ezuadir unificou os reinos fragmentados de Hyperbius com pura força de vontade. Sua genialidade tática era inigualável, e seu poder era amplificado pelo artefato **Xenoblade**, uma arma capaz de cortar o próprio tecido da realidade. Seu legado é uma mistura de admiração e terror."
            },
            "necropolis": {
                riddle: "Meu rei nos condenou a uma existência despedaçada entre a vida e a morte. Que reino sou eu?",
                answer: "Outrora um reino grandioso, Necropolis é hoje um testamento sombrio da ambição de seu último imperador, Koema. Em sua busca por imortalidade, ele realizou um ritual que despedaçou o reino, lançando-o em um limbo entre a vida e a morte. Suas terras são agora ilhas flutuantes em um céu de crepúsculo eterno, habitadas por mortos-vivos e espectros."
            },
            "laplace": {
                riddle: "Em meus corredores, o tempo dança e a tecnologia ganha vida. Onde estou?",
                answer: "Escondido nas profundezas da Cidadela do Imperador, este laboratório é o epicentro de criações arcanas e tecnológicas. Foi aqui que Laplace Xang, o inventor, deu vida a maravilhas e horrores. O laboratório é uma masmorra em constante mudança, com salas que se reconfiguram e criaturas biomecânicas guardando segredos de uma era passada. Dizem que o próprio tempo se comporta de maneira errática em seus corredores."
            },
            "vento ardente": {
                riddle: "Sou uma terra de areia vermelha e calor implacável, um teste para os fortes. Como me chamo?",
                answer: "Uma vasta planície desértica de areia avermelhada e formações rochosas que se assemelham a ossos de gigantes. O calor é implacável, e tempestades de areia podem surgir sem aviso. Tribos nômades e criaturas como os vermes de areia habitam esta terra inóspita. É um lugar de provação, onde apenas os mais fortes sobrevivem."
            },
            "vento glacial": {
                riddle: "Meu sopro congela a alma e minhas montanhas são de gelo eterno. Que lugar sou eu?",
                answer: "O oposto do Vento Ardente, esta é uma tundra congelada, coberta por uma neve eterna e montanhas de gelo afiadas como navalhas. O frio é tão intenso que pode congelar a alma, e criaturas como o Urso Rei Polar vagam pela paisagem. Ruínas de uma civilização antiga estão enterradas sob o gelo, guardando segredos e perigos."
            }
        };

        const bootSequence = [
            "INICIANDO SISTEMA HYPERBIUS v1.3...",
            "CONECTANDO AO SANTUÁRIO DOS EXPEDICIONÁRIOS...",
            "AVISO: LINK QUÂNTICO INSTÁVEL. FLUTUAÇÕES DE CAOS E ORDEM DETECTADAS.",
            "BEM-VINDO AOS ARQUIVOS DE KUAR-TOR",
            " ",
            "Digite 'ajuda' para ver a lista de chaves.",
        ];

        function focusInput() {
            inputField.focus();
        }

        // Função de digitação com som
        async function typeWriter(text, element, speed = 30) {
            return new Promise(resolve => {
                let i = 0;
                function type() {
                    if (i < text.length) {
                        if (typeSound && text.charAt(i) !== ' ' && text.charAt(i) !== '\n') {
                           typeSound.triggerAttackRelease("C6", "0.05");
                        }
                        element.innerHTML += text.charAt(i);
                        i++;
                        terminal.scrollTop = terminal.scrollHeight;
                        setTimeout(type, speed);
                    } else {
                        resolve();
                    }
                }
                type();
            });
        }
        
        // Função de digitação silenciosa, para ser usada antes da inicialização do áudio
        async function typeWriterSilent(text, element, speed = 50) {
            return new Promise(resolve => {
                let i = 0;
                function type() {
                    if (i < text.length) {
                        element.innerHTML += text.charAt(i);
                        i++;
                        terminal.scrollTop = terminal.scrollHeight;
                        setTimeout(type, speed);
                    } else {
                        resolve();
                    }
                }
                type();
            });
        }
        
        async function playDialUpSound() {
            return new Promise(async (resolve) => {
                const dialMsg = document.createElement('p');
                terminalOutput.appendChild(dialMsg);
                await typeWriter("DISCANDO...", dialMsg, 50);

                const noise = new Tone.Noise("white").toDestination();
                const synth = new Tone.FMSynth({
                    harmonicity: 3, modulationIndex: 10,
                    envelope: { attack: 0.01, decay: 0.2, sustain: 0.2, release: 0.2 },
                    modulationEnvelope: { attack: 0.01, decay: 0.2, sustain: 0.2, release: 0.2 }
                }).toDestination();
                
                noise.volume.value = -20;

                const dtmf = (f1, f2) => {
                    const o1 = new Tone.Oscillator(f1, "sine").toDestination();
                    const o2 = new Tone.Oscillator(f2, "sine").toDestination();
                    o1.volume.value = -15; o2.volume.value = -15;
                    o1.start().stop("+0.15"); o2.start().stop("+0.15");
                };
                
                Tone.Transport.scheduleOnce(() => dtmf(697, 1209), "0.1");
                Tone.Transport.scheduleOnce(() => dtmf(770, 1336), "0.4");
                Tone.Transport.scheduleOnce(() => dtmf(852, 1477), "0.7");

                Tone.Transport.scheduleOnce(() => {
                    noise.start().stop("+2.5");
                    synth.triggerAttackRelease("C2", "0.2", Tone.now());
                    synth.frequency.rampTo("C4", 1, Tone.now() + 0.5);
                }, "1.0");

                Tone.Transport.scheduleOnce(async () => {
                    new Tone.Synth().toDestination().triggerAttackRelease("C5", "0.5");
                    dialMsg.textContent = "CONECTADO.";
                    resolve();
                }, "3.5");
                
                Tone.Transport.start();
            });
        }

        async function handleCommand() {
            const command = inputField.value.trim().toLowerCase();
            if (command === '') return;

            const commandElement = document.createElement('p');
            commandElement.textContent = `${promptSymbol.textContent} ${command}`;
            terminalOutput.appendChild(commandElement);
            
            inputField.value = '';
            inputLine.style.display = 'none';

            if (currentRiddle) {
                if (command === currentRiddle) {
                    const response = riddles[currentRiddle].answer;
                    const responseElement = document.createElement('p');
                    responseElement.className = "text-green-400 my-2";
                    terminalOutput.appendChild(responseElement);
                    await typeWriter(response, responseElement);
                } else {
                    const errorElement = document.createElement('p');
                    errorElement.className = "text-red-500 my-2";
                    terminalOutput.appendChild(errorElement);
                    await typeWriter("CHAVE DE SINCRONIZAÇÃO INCORRETA. TENTE NOVAMENTE.", errorElement);
                }
                currentRiddle = null;
                promptSymbol.textContent = '>';
            } else {
                if (command === 'limpar') {
                    terminalOutput.innerHTML = '';
                } else if (riddles[command]) {
                    const riddleData = riddles[command];
                    const riddleElement = document.createElement('p');
                    riddleElement.className = "text-yellow-400 my-2";
                    terminalOutput.appendChild(riddleElement);
                    
                    if (command === 'ajuda') {
                         await typeWriter(riddleData.answer, riddleElement);
                    } else {
                        await typeWriter(riddleData.riddle, riddleElement);
                        currentRiddle = command;
                        promptSymbol.textContent = '?';
                    }
                } else {
                    const errorElement = document.createElement('p');
                    errorElement.className = "text-red-500 my-2";
                    terminalOutput.appendChild(errorElement);
                    await typeWriter("ERRO: CHAVE DESCONHECIDA.", errorElement);
                }
            }
            
            inputLine.style.display = 'flex';
            terminal.scrollTop = terminal.scrollHeight;
            focusInput();
        }

        inputField.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                handleCommand();
            }
        });

        async function startTerminal() {
            for (const line of bootSequence) {
                const lineElement = document.createElement('p');
                terminalOutput.appendChild(lineElement);
                await typeWriter(line, lineElement, 20);
            }
            inputLine.style.display = 'flex';
            focusInput();
        }
        
        async function initiateConnection() {
            if (isAudioStarted) {
                focusInput();
                return;
            }
            isAudioStarted = true;
            
            terminalOutput.innerHTML = ''; 
            await Tone.start();

            typeSound = new Tone.MembraneSynth({
                pitchDecay: 0.008,
                octaves: 2,
                envelope: { attack: 0.001, decay: 0.1, sustain: 0.01, release: 0.01 },
            }).toDestination();
            typeSound.volume.value = -25;

            await playDialUpSound();
            await startTerminal();
        }

        window.onload = async () => {
            const initialMsg = document.createElement('p');
            terminalOutput.appendChild(initialMsg);
            // Usa a versão silenciosa da função de digitação para a mensagem inicial
            await typeWriterSilent("CLIQUE PARA INICIAR CONEXÃO...", initialMsg, 50);
        };

    </script>
</body>
</html>
